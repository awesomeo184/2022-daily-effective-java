# 76. 가능한 한 실패 원자적으로 만들라

## 실패원자성?

호출된 메서드가 실패해도, 해당 객체는 **호출 전 상태**를 유지해야 함

## 실패원자성을 지키는 법

0. **불변객체**로 설계!!!

1. 매개변수의 **유효성 검사**

```java
public Object pop(){
        if(size==0){
        throw new EmptyStackException();
        }
        Object result=elements[--size];
        elements[size]=null
        return result;
        }
```

- 만약 위의 예외처리가 없다면?
    - 예외처리가 없어도 예외는 던져짐
    - 그러나, 다음번 메소드 호출 시 무조건 음수! 계속 실패!

2. **실패할 가능성이 있는 코드**를 객체 상태 변경 코드 **앞에 위치**
3. 객체의 임시 **복사본**에서 작업 수행 -> 성공 시 원 객체에 적용
4. 실패 시의 복구코드 작성(자주 안쓰임)

## 실패원자성을 만족할 수 없는 경우

1. 두 스레드가 동기화 없이 같은 객체를 동시 수정할 때
2. Error -> 복구 불가
